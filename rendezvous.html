<!DOCTYPE html>
<html lang="fr">
<head>
    <!-- Metadonnées -->
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="Sohan Anampalli & Arsène Brosy" name="author">
    <meta content="Création, site, internet, web, design" name="keywords">
    <meta content="Creez vos sites web avec des pros a mini-prix" name="description">

    <!-- Titre -->
    <title>Devcastle - Création de site webs a mini-prix</title>

    <!-- CSS -->
    <link href="../css/fonts/fonts.css" rel="stylesheet">
    <link href="../css/main.css" rel="stylesheet">
</head>
<body class="pRDV">
<div id="popup-ok" style="display: none;">
    <div>
        <h1>Rendez-vous effectué</h1>
        <p>Nous vous enverrons un mail dans les jours qui suivent pour confirmer votre rendez-vous.</p>
        <a href="./">Retourner a l'acceuil</a>
    </div>
</div>
<h1>Rendez-vous - Devcastle</h1>
<p class="free">Gratuit</p>
<p>Parlons de vos envies, vos idée, vos ambitions et
    nous choisirons ensemble comment creer votre site.</p>
<div class="content">
    <h2></h2>
    <div id="methods">
        <button onclick="setMode(0)">Presentiel (recommandé)</button>
        <button onclick="setMode(1)">Videoconférence</button>
    </div>
    <h2 id="method-title">Ou pouvons-nous se rencontrer ?</h2>
    <div id="adress">
        <p>Localité</p>
        <input placeholder="NPA" type="number">
        <input placeholder="Localité" type="text">
        <p>Adresse</p>
        <textarea id="adresse" placeholder="Votre adresse"></textarea>
    </div>
    <div id="video">
        <div class="plateforms">
            <button onclick="setVideo(0)">Skype</button>
            <button onclick="setVideo(1)">Discord</button>
            <button onclick="setVideo(2)">Zoom</button>
        </div>
        <p>Nom d'utilisateur</p>
        <input placeholder="Votre nom d'utilisateur skype" type="text">
    </div>
    <h2>Date et Heure</h2>
    <div class="datetime">
        <p id="datetime-name">Nom</p>
        <div class="selector">
            <div id="calendar">
                <div class="header">
                    <button onclick="calendarBackward()"></button>
                    <button onclick="calendarForward()"></button>
                    <p>Mois</p>
                </div>
                <div class="daynames">
                    <p>lu</p>
                    <p>ma</p>
                    <p>me</p>
                    <p>je</p>
                    <p>ve</p>
                    <p>sa</p>
                    <p>di</p>
                </div>
                <div class="days">
                </div>
            </div>
            <div id="time">
                <div class="header">
                    <p>Heures disponibles</p>
                </div>
                <div class="hours">

                </div>
            </div>
        </div>
    </div>
    <h2>Vos informations</h2>
    <div class="infos">
        <div>
            <p>Nom</p>
            <input id="infos-name" placeholder="Votre nom" type="text">
            <p>Adresse email</p>
            <input id="infos-email" placeholder="Votre adresse email" type="email">
            <p>Numero de télephone</p>
            <input id="infos-tel" placeholder="Votre numero de télephone" type="tel">
        </div>
        <div>
            <p>Notes</p>
            <textarea id="infos-more"
                      placeholder="Ajoutez des demandes spéciales, des remarques, des questions, etc"></textarea>
        </div>
    </div>
    <p id="error-message"></p>
    <button id="submitButton">Reserver</button>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js" type="text/javascript"></script>
    <script src="./Javascript/rendezvous.js"></script>
    <script type="module">
        import {initializeApp} from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
        import {
            getDatabase,
            set,
            ref,
            update,
            onValue
        } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-database.js";
        import {getAuth} from "https://www.gstatic.com/firebasejs/9.19.1/firebase-auth.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDpxXNFrji99t8a6QTcKhCmgIdA0ibs_lk",
            authDomain: "webcastle-website.firebaseapp.com",
            databaseURL: "https://webcastle-website-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "webcastle-website",
            storageBucket: "webcastle-website.appspot.com",
            messagingSenderId: "274339465548",
            appId: "1:274339465548:web:927dd550601c84dffce7e9"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth();


        submitButton.addEventListener('click', (e) => {

            const user = auth.currentUser;

            errorMsg.innerHTML = "";
            if ((adressFields.children[2].value === "" || adressFields.children[4].value === "") && mode === 0) {
                errorMsg.innerHTML = "Veuillez saisir une adresse complète";
            } else if (videoFields.children[2].value === "" && mode === 1) {
                errorMsg.innerHTML = "Veuillez votre nom d'utilisateur " + videoModeString;
            } else if (selectedHour === -1) {
                errorMsg.innerHTML = "Veuillez selectionner une heure";
            } else if (document.getElementById("infos-name").value === "") {
                errorMsg.innerHTML = "Veuillez saisir votre nom";
            } else if (!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(document.getElementById("infos-email").value)) {
                errorMsg.innerHTML = "Veuillez saisir un email correct";
            } else if (document.getElementById("infos-tel").value === "") {
                errorMsg.innerHTML = "Veuillez saisir votre numero de télephone";
            } else {

                submit()

                if (mode === 0) {
                    set(ref(database, 'users/' + user.uid + "/rdv"), {
                        datetime: dname.innerHTML,
                        email: document.getElementById('infos-email').value,
                        mode: "presentiel",
                        loc: adressFields.children[1].value + " " + adressFields.children[2].value + " | " + document.getElementById('adresse').value,
                        name: document.getElementById("infos-name").value,
                        tel: document.getElementById("infos-tel").value,
                        more: document.getElementById("infos-more").value,
                    });
                } else {
                    set(ref(database, 'users/' + user.uid + "/rdv"), {
                        datetime: dname.innerHTML,
                        email: document.getElementById('infos-email').value,
                        mode: "visio",
                        plateform: videoModeString,
                        username: videoFields.children[2].value,
                        name: document.getElementById("infos-name").value,
                        tel: document.getElementById("infos-tel").value,
                        more: document.getElementById("infos-more").value,
                    });
                }
            }
        });
    </script>
</div>
<script>
    function submit() {

        if (mode === 0) {
            var templateParams = {

                adress: adressFields.children[4].value,
                npa: adressFields.children[1].value,
                loc: adressFields.children[2].value,
                name: document.getElementById("infos-name").value,
                email: document.getElementById("infos-email").value,
                tel: document.getElementById("infos-tel").value,
                more: document.getElementById("infos-more").value,
            };

            emailjs.send('service_gtw1i4t', 'template_vo11f77', templateParams).then(function (response) {
                document.getElementById("popup-ok").style.display = "flex";
                document.body.style.overflow = 'hidden';
                window.scrollTo(0, 0);
            });
        }
        if (mode === 1) {
            var templateParams = {
                datetime: dname.innerHTML,
                plateform: videoModeString,
                username: videoFields.children[2].value,
                name: document.getElementById("infos-name").value,
                email: document.getElementById("infos-email").value,
                tel: document.getElementById("infos-tel").value,
                more: document.getElementById("infos-more").value,
            };
            emailjs.send('service_gtw1i4t', 'template_ht3k4w7', templateParams).then(function (response) {
                document.getElementById("popup-ok").style.display = "flex";
                document.body.style.overflow = 'hidden';
                window.scrollTo(0, 0);
            });
        }

    }

</script>
</body>
</html>